# Introduction #
There are two levels of protection provided by Duplicati:
  * Encryption of files stored on remote machine
  * Encryption of settings stored on the local machine

This document describes how to use the protection features to best protect your data from unwanted exposure.

# Encryption of files stored on remote machine #
Duplicati supports two basic modes on encryption:
  * AES
  * GPG (Gnu Privacy Guard)

It is possible to add new (possibly proprietary) encryption modules, although none are currently known to exist. It is also possible to disable encryption which should only be used if the backend is fully trusted.

Duplicati defaults to using AES encryption with a strong random password generated by the UI. Duplicati 1.0 Final uses a simple raw AES encryption, which was updated in [r427](https://code.google.com/p/duplicati/source/detail?r=427) to use the [AESCrypt file format](http://www.aescrypt.com/format).

[AESCrypt](http://www.aescrypt.com/) has several advantages and Duplicati will seamlessly use the new format. The AES encryption uses AES-256 for both version. [AESCrypt](http://www.aescrypt.com/) has no way of changing the key size in the current version, although that could be made a Duplicati-only extension.

GPG support is unchanged, and a GPG client for windows is bundled with Duplicati since [r491](https://code.google.com/p/duplicati/source/detail?r=491).

The encryption strength of these should be similar, although GPG can be further configured to use a different key size for AES, or another algorithm.

# Encryption of settings stored on the local machine #
Duplicati uses a SQLite database to store all settings, including server names, logins and encryption keys.

The database is placed in %APP\_DATA%/Duplicati/Duplicati.sqlite.

Version 1.0 has no method of changing this location and no methods for protecting it. In version 1.0 it is also possible to read the passwords by simply editing the backup from within the user interface.

Duplicati 1.0.1 [r498](https://code.google.com/p/duplicati/source/detail?r=498) introduced a protection feature in the UI which prevents the password from being read.

## Database encryption ##

The [r498](https://code.google.com/p/duplicati/source/detail?r=498) version also adds database encryption to Duplicati. On windows this feature is automatically activated upon startup, encrypting any existing database.

Unfortunately the SQLite version found in Ubuntu does not support the encryption feature, so Linux user have to enable the encryption feature manually.

The database encryption works by setting the environemnt variable named DUPLICATI\_DB\_KEY to the desired database key before launching Duplicati.exe.

On windows the default key is set to "Duplicati\_Key\_42".

You will need this key if you whish to change the database password, or open the database with a thirdparty SQLite tool (not all support encryption though).

On linux the database is unencrypted by default.

## Important remarks ##

**Note:** Since the password is **PUBLIC** it does not provide protection against a determined attacker. Its primary purpose is to protect against casual browsing of the machine as well as harddisk string searches. Users that require a stronger protection are adviced to change the password.

**Note:** If you intend to use the "Restore setup" function, you must also lauch Duplicati with the correct database password set when restoring the setup.

**Note:** The Duplicati UI will include the setup database in the backup set by default, to enable the "Restore setup" function. This means that the settings database will also be present in the backup data, which can be a problem if neither the database nor the backup files are encrypted.

**Note:** The database encryption uses [RC4 encryption, which is known to have weaknesses](http://en.wikipedia.org/wiki/RC4).

## Disabling database encryption ##

If you wish to process the database with an external tool that does not support encryption, you can make Duplicati decrypt the database for you.

Simply start Duplicati.exe with the commandline option --unencrypted-database.

If the database is not encrypted, no change will happen, otherwise it will be decrypted.

You need the DUPLICATI\_DB\_KEY to be set to the correct password or the decryption will fail.

## Changing the database password ##

To change the database password, you first disable the encryption (which decrypts the database) and then re-enable it (which encrypts the database).

On windows execute these lines:
```
SET DUPLICATI_DB_KEY=Old_Password
Duplicati.exe --unencrypted-database
REM
REM Now close Duplicati
REM
SET DUPLICATI_DB_KEY=New_Password
Duplicati.exe
```

On linux do this:
```
export DUPLICATI_DB_KEY=Old_Password
mono Duplicati.exe --unencrypted-database
#
# Now close Duplicati
#
export DUPLICATI_DB_KEY=New_Password
mono Duplicati.exe
```

## Launching with a custom database password ##
On windows you can put the following in a .bat file to set the password:
```
@echo off
SET DUPLICATI_DB_KEY=My_New_Password
"C:\Program Files\Duplicati\Duplicati.exe"
```

On linux this will do the same:
```
#!/bin/bash
export DUPLICATI_DB_KEY=My_New_Password
mono Duplicati.exe
```

## Other protection measures ##
Another way to protect the settings database is to use an encrypted folder to store the data.

The encrypted home folder is available on all major Linux distributions and on Windows 7 for all editions greater than Home Premium.

A number of users are also using Duplicati to back up files store in an enctypted container, eg. [TrueCrypt](http://www.truecrypt.org/).

Backing up the files inside the container is much more efficient than backing up the container file, as the encryption makes the changes appear random, rather than structured.

While this can be done with the commandline version, some users will find it easier to use the GUI version.

To assist in this, it is now possible to specify the location of the Duplicati database, which is required by Duplicati.

The simplest way of doing this is to start Duplicati with the commandline parameter --portable-mode.

This will create a folder called "data" below the Duplicati program folder, in which the Duplicati data files will be placed, including the database. This ensures that the database is also protected by the encryption container, eg. [TrueCrypt](http://www.truecrypt.org/).

If you need to specify the exact location of the data files, set the environment variable DUPLICATI\_HOME to the full path of the folder where the data should be stored.